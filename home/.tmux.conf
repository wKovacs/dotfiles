# =======================================================================
# TMUX BASE CONFIGURATION
# =======================================================================
set-option -g status on
set-option -g status-interval 2
set-option -g status-justify "centre"

# Set set-clipboard to external for newer tmux versions
set -s set-clipboard external

# Mouse Toggle: Ctrl-b m
set -g mouse on
bind-key -T prefix m set -g mouse\; display 'Mouse: #{?mouse,ON,OFF}'
# Reload config: Ctrl-b M-r (Alt-r)
bind-key -T prefix M-r source-file ~/.tmux.conf

# Titlestuff
set-option -g set-titles on
set-option -g set-titles-string "#S:#P #W"
set-option -g allow-rename on


# =======================================================================
# PLUGINS & INITIALIZATION
# =======================================================================

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'erikw/tmux-powerline'
set -g @plugin 'tmux-plugins/tmux-yank'

run '~/.tmux/plugins/tpm/tpm'


# =======================================================================
# CUSTOM KEYBINDINGS & OVERWRITES
# =======================================================================

## ðŸ§  APPLICATION MOUSE CONTROL TOGGLE (Manual Toggle): Ctrl-b t
# The robust, simple toggle. Displays status when executed.
bind-key -T prefix t if -F "#{mouse_any_flag}" "set -g mouse off; display 'Mouse OFF'" "set -g mouse on; display 'Mouse ON'"

# --- MOUSE FUNCTIONALITY (Explicitly forcing shell marking) ---

# Mouse drag start: Force tmux to start marking immediately in ANY pane.
bind-key -n MouseDrag1Pane copy-mode -M

# Mouse Wheel Scrolling: Ensure scrolling works correctly
bind-key -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" \
    "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind-key -n WheelDownPane select-pane -t= \; send-keys -M

# Keyboard yank with 'y' (for use in tmux copy mode)
unbind-key -T copy-mode y
unbind-key -T copy-mode-vi y
bind-key -T copy-mode y send -X copy-pipe-and-cancel 'xclip -selection clipboard -i'
bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel 'xclip -selection clipboard -i'


# --- KEYBOARD COPY/PASTE SETUP ---

# Enter copy-mode with Space (via prefix)
bind-key -T prefix Space copy-mode -e

# Copy-mode selection keys
bind-key -T copy-mode Space if -F "#{selection_present}" { send -X clear-selection } { send -X begin-selection }
bind-key -T copy-mode Enter send -X copy-pipe-and-cancel 'xclip -selection clipboard -i'


# --- PASTE WITH RIGHT CLICK ---
unbind-key -n MouseDown3Pane
bind-key -T root MouseUp3Pane run -b "wl-paste --no-newline 2>/dev/null | tmux load-buffer - && tmux paste-buffer -p"
